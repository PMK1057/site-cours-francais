<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expressions idiomatiques fran√ßaises</title>
    <style>
        .idioms-container { max-width: 980px; margin: 0 auto; padding: 28px 22px; box-sizing: border-box; }
        h2 { color: #6d4ac3; font-family: 'Georgia', serif; text-align: center; margin: 0 0 18px; }
        p.lead { color: #212744; opacity: .9; margin-bottom: 18px; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin: 12px 0 24px; box-shadow: 0 2px 10px rgba(0,0,0,.08); }
        th, td { padding: 12px 14px; border-bottom: 1px solid #e9ecef; }
        th { background: #f5f6ff; color: #3f2f92; text-align: left; }
        /* Hover seulement si pas de classe register */
        tr:not(.register-courant):not(.register-un-peu-familier):not(.register-familier):hover td { background: #fafbff; }
        .en { color: #425466; font-size: .95em; }
        .note { background: #fff7e6; border-left: 4px solid #ffb84d; padding: 12px 14px; border-radius: 8px; color: #7a5b10; margin: 10px 0 18px; }
        
        /* Couleurs par registre - plus visibles */
        .register-courant td { background-color: #e8f5e9 !important; border-left: 4px solid #4caf50; }
        .register-un-peu-familier td { background-color: #fff9e6 !important; border-left: 4px solid #ffb84d; }
        .register-familier td { background-color: #ffe6e6 !important; border-left: 4px solid #ff6b6b; }
        
        /* Hover ne doit pas masquer les couleurs */
        .register-courant:hover td { background-color: #d4edda !important; }
        .register-un-peu-familier:hover td { background-color: #fff3cd !important; }
        .register-familier:hover td { background-color: #f8d7da !important; }
        
        /* √âtoiles pour les expressions importantes */
        .star { color: #ffb84d; font-size: 1.1em; margin-right: 4px; }
        .star-important { color: #ff6b6b; font-size: 1.2em; margin-right: 4px; }
        
        /* L√©gende */
        .legend { display: flex; gap: 20px; flex-wrap: wrap; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-color { width: 20px; height: 20px; border-radius: 4px; border-left: 4px solid; }
        .legend-courant { background-color: #e8f5e9; border-left-color: #4caf50; }
        .legend-un-peu-familier { background-color: #fff9e6; border-left-color: #ffb84d; }
        .legend-familier { background-color: #ffe6e6; border-left-color: #ff6b6b; }
        
        /* Boutons audio */
        .audio-btn {
            display: inline-flex !important;
            align-items: center;
            justify-content: center;
            width: 36px !important;
            height: 36px !important;
            margin-left: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2) !important;
            color: #ffffff !important;
            border: none !important;
            border-radius: 999px;
            cursor: pointer;
            font-size: 1.1em !important;
            box-shadow: 0 6px 14px rgba(102, 126, 234, 0.35) !important;
            transition: transform 0.18s ease, box-shadow 0.18s ease;
            vertical-align: middle;
        }

        .audio-btn:hover {
            transform: translateY(-1px) scale(1.04);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.45) !important;
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .audio-btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
        }
    </style>
</head>
<body>
    <div class="idioms-container">
        <button class="back-btn" onclick="backToSection('expressions')">‚Üê Retour</button>
        <h2>üß† Expressions idiomatiques</h2>
        <p class="lead">Registre familier / courant, tournures fig√©es et idiomes tr√®s utilis√©s au quotidien.</p>

        <div class="note">
            Conseil: apprends-les en blocs complets. Leur sens est souvent figur√©; une traduction mot √† mot ne fonctionne pas.
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color legend-courant"></div>
                <span>Courant</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-un-peu-familier"></div>
                <span>Un peu familier</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-familier"></div>
                <span>Familier</span>
            </div>
            <div class="legend-item">
                <span class="star-important">‚≠ê</span>
                <span>Important</span>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Expression (FR)</th>
                    <th>English</th>
                </tr>
            </thead>
            <tbody>
                <!-- Expressions avec √©toiles (selon demande utilisateur) -->
                <tr class="register-courant"><td><span class="star-important">‚≠ê</span>Passer un coup de fil</td><td class="en">to make a phone call</td></tr>
                <tr class="register-un-peu-familier"><td><span class="star-important">‚≠ê</span>Avoir la flemme</td><td class="en">to feel too lazy / can't be bothered</td></tr>
                <tr class="register-un-peu-familier"><td><span class="star-important">‚≠ê</span>√ätre √† la bourre</td><td class="en">to be running late (informal)</td></tr>
                <tr class="register-un-peu-familier"><td><span class="star-important">‚≠ê</span>√ätre crev√©</td><td class="en">to be exhausted</td></tr>
                <tr class="register-familier"><td><span class="star-important">‚≠ê</span>C'est la gal√®re</td><td class="en">it's a pain / it's tough</td></tr>
                <tr class="register-courant"><td><span class="star-important">‚≠ê</span>Faire la grasse matin√©e</td><td class="en">to sleep in</td></tr>
                
                <!-- Autres expressions sans √©toiles -->
                <tr class="register-courant"><td>Filer un coup de main</td><td class="en">to give a hand, help out</td></tr>
                <tr class="register-courant"><td>Faire d'une pierre deux coups</td><td class="en">to kill two birds with one stone</td></tr>
                <tr class="register-courant"><td>Boire un coup</td><td class="en">to have a (quick) drink</td></tr>
                <tr class="register-courant"><td>Faire marche arri√®re</td><td class="en">to backtrack, reverse a decision</td></tr>
                <tr class="register-courant"><td>Avoir un coup de foudre</td><td class="en">love at first sight</td></tr>
                <tr class="register-courant"><td>Avoir du pain sur la planche</td><td class="en">to have a lot on one's plate</td></tr>
                <tr class="register-courant"><td>Tourner en rond</td><td class="en">to go around in circles, make no progress</td></tr>
                <tr class="register-courant"><td>Mettre toutes les chances de son c√¥t√©</td><td class="en">to stack the odds in one's favor</td></tr>
                <tr class="register-un-peu-familier"><td>Se prendre la t√™te</td><td class="en">to overthink / stress oneself out</td></tr>
                <tr class="register-un-peu-familier"><td>Prendre la t√™te (√† quelqu'un)</td><td class="en">to annoy/bother (to get on someone's nerves)</td></tr>
                <tr class="register-un-peu-familier"><td>Avoir un chat dans la gorge</td><td class="en">to have a frog in one's throat (hoarse)</td></tr>
                <tr class="register-un-peu-familier"><td>Tomber dans les pommes</td><td class="en">to faint, pass out</td></tr>
                <tr class="register-un-peu-familier"><td>Avoir un petit creux</td><td class="en">to feel a bit hungry</td></tr>
                <tr class="register-un-peu-familier"><td>Avoir la gueule de bois</td><td class="en">to have a hangover</td></tr>
                <tr class="register-familier"><td>Avoir la dalle</td><td class="en">to be starving (slang)</td></tr>
                <tr class="register-familier"><td>P√©ter un c√¢ble</td><td class="en">to freak out / lose it (very informal)</td></tr>
                <tr class="register-familier"><td>Prendre une cuite</td><td class="en">to get drunk (slang)</td></tr>
                <tr class="register-familier"><td>Avoir le seum</td><td class="en">to be salty / annoyed (slang)</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        // Protection: s'assure que backToSection existe m√™me si appel√© directement
        if (typeof backToSection !== 'function') {
            window.backToSection = function(sectionId){ window.location.hash = '#section=' + (sectionId || 'expressions'); };
        }
    </script>
    <script>
        (async function () {
            function cleanFilename(text) {
                if (!text) return '';
                // Minuscule
                text = text.toLowerCase();
                // Enlever les accents
                text = text.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                // Remplacer tout ce qui n'est pas [a-z0-9] par des underscores
                text = text.replace(/[^a-z0-9]+/g, '_');
                // Enlever les underscores en d√©but/fin
                text = text.replace(/^_+|_+$/g, '');
                return text;
            }

            async function loadAudioUrls() {
                let audioUrls = {};
                try {
                    let response = await fetch('audio_urls.json');
                    if (!response.ok) {
                        response = await fetch('../audio_urls.json');
                    }
                    if (!response.ok) {
                        response = await fetch('/audio_urls.json');
                    }
                    if (response.ok) {
                        audioUrls = await response.json();
                    } else {
                        console.warn('Fichier audio_urls.json introuvable pour les expressions idiomatiques');
                    }
                } catch (error) {
                    console.warn('Erreur lors du chargement des URLs audio pour les expressions idiomatiques:', error);
                }
                return audioUrls;
            }

            const audioUrls = await loadAudioUrls();
            console.log('Audio URLs charg√©es:', Object.keys(audioUrls).length, 'fichiers');
            
            if (!audioUrls || Object.keys(audioUrls).length === 0) {
                console.warn('Aucun fichier audio trouv√© dans audio_urls.json');
                return;
            }

            const table = document.querySelector('.idioms-container table');
            if (!table) {
                console.warn('Tableau non trouv√©');
                return;
            }

            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const firstCell = row.querySelector('td');
                if (!firstCell) return;

                // Extraire le texte en enlevant les √©toiles et autres √©l√©ments
                let expressionText = firstCell.textContent.trim();
                // Enlever les √©toiles et autres caract√®res sp√©ciaux au d√©but
                expressionText = expressionText.replace(/^[‚≠ê\s]+/, '').trim();
                if (!expressionText) return;

                const filename = cleanFilename(expressionText);
                console.log(`Recherche audio pour: "${expressionText}" ‚Üí filename: "${filename}"`);
                const audioData = audioUrls[filename];
                if (!audioData) {
                    console.warn(`Audio non trouv√© pour: ${filename}`);
                    return;
                }

                const audioUrl = typeof audioData === 'string' ? audioData : audioData.url;
                if (!audioUrl) {
                    console.warn(`URL audio vide pour: ${filename}`);
                    return;
                }
                console.log(`‚úÖ Audio trouv√© pour "${expressionText}": ${audioUrl}`);

                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'audio-btn';
                btn.textContent = 'üîä';
                btn.title = `√âcouter "${expressionText}"`;
                btn.setAttribute('aria-label', `√âcouter la prononciation de "${expressionText}"`);
                btn.addEventListener('click', () => {
                    if (typeof playAudio === 'function') {
                        playAudio(audioUrl);
                    } else {
                        // Fallback: jouer directement l'audio
                        const audio = new Audio(audioUrl);
                        audio.play().catch(e => console.error('Erreur lecture audio:', e));
                    }
                });

                firstCell.appendChild(btn);
                console.log(`‚úÖ Bouton audio ajout√© pour "${expressionText}"`);
            });
        })();
    </script>
</body>
</html>



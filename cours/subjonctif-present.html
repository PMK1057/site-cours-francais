
    <button class="back-btn" onclick="backToSection('conjugaison')">‚Üê Retour</button>
    
    <h2>üé≠ LE SUBJONCTIF PR√âSENT</h2>
    
    <style>
        .indicatif-alert {
            background: #fee2e2;
            border-left: 4px solid #dc2626;
            padding: 18px 22px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 6px 18px rgba(220, 38, 38, 0.12);
        }
        .indicatif-alert h4 {
            margin-top: 0;
            color: #b91c1c;
            font-weight: 700;
        }
        .indicatif-alert ul {
            margin: 10px 0 16px 20px;
            line-height: 1.8;
        }
        .indicatif-alert li::before {
            content: "‚ùó";
            margin-right: 6px;
            color: #dc2626;
        }
        .inline-feedback {
            margin-top: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            display: block;
            visibility: hidden;
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(229, 231, 235, 0.6);
            border: 1px solid transparent;
        }
        .inline-feedback.good {
            color: #166534;
            background: #dcfce7;
            border-color: #86efac;
        }
        .inline-feedback.bad {
            color: #b91c1c;
            background: #fee2e2;
            border-color: #fecaca;
        }
        .verb-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
            margin: 18px 0;
        }
        .verb-card {
            background: #f5f7ff;
            border: 1px solid #d6dcfb;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 10px 18px rgba(102, 126, 234, 0.12);
        }
        .verb-card h5 {
            margin-top: 0;
            font-size: 1.05rem;
            color: #3b4cc0;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }
        .verb-card ul {
            list-style: none;
            margin: 12px 0 0 0;
            padding: 0;
            line-height: 1.8;
        }
        .verb-card li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        .audio-chip {
            border: none;
            background: #4f46e5;
            color: white;
            border-radius: 999px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: transform 0.2s ease, background 0.2s ease;
        }
        .audio-chip:hover {
            background: #3730a3;
            transform: translateY(-1px);
        }
        .aa-question {
            margin-bottom: 18px;
        }
    </style>
    
    <div class="info-box">
        <h3>üìå Qu'est-ce que c'est ?</h3>
        <p>Le subjonctif pr√©sent exprime le <strong>doute</strong>, le <strong>souhait</strong>, la <strong>n√©cessit√©</strong>, l'<strong>√©motion</strong> ou la <strong>possibilit√©</strong>. Il est souvent utilis√© apr√®s "que".</p>
    </div>

    <h3>Formation</h3>
    <p><strong>Base : radical de "ils" au pr√©sent + terminaisons : -e, -es, -e, -ions, -iez, -ent</strong></p>
    
    <h3>Conjugaison des verbes r√©guliers</h3>
    
    <div class="example-box">
        <h4>PARLER (1er groupe -ER)</h4>
        <p>Ils parl<strong>ent</strong> ‚Üí radical = <strong>parl</strong></p>
        <ul>
            <li>que je parl<strong>e</strong></li>
            <li>que tu parl<strong>es</strong></li>
            <li>qu'il/elle parl<strong>e</strong></li>
            <li>que nous parl<strong>ions</strong></li>
            <li>que vous parl<strong>iez</strong></li>
            <li>qu'ils/elles parl<strong>ent</strong></li>
        </ul>
    </div>

    <div class="example-box">
        <h4>FINIR (2√®me groupe -IR)</h4>
        <p>Ils finiss<strong>ent</strong> ‚Üí radical = <strong>finiss</strong></p>
        <table>
            <thead>
                <tr>
                    <th>Personne</th>
                    <th>Conjugaison</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>que je</td><td>finiss<strong>e</strong></td></tr>
                <tr><td>que tu</td><td>finiss<strong>es</strong></td></tr>
                <tr><td>qu'il/elle</td><td>finiss<strong>e</strong></td></tr>
                <tr><td>que nous</td><td>finiss<strong>ions</strong></td></tr>
                <tr><td>que vous</td><td>finiss<strong>iez</strong></td></tr>
                <tr><td>qu'ils/elles</td><td>finiss<strong>ent</strong></td></tr>
            </tbody>
        </table>
    </div>

    <h3>Verbes irr√©guliers importants</h3>
    <table>
        <thead>
            <tr>
                <th>Infinitif</th>
                <th>que je...</th>
                <th>que nous...</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>√™tre</td><td>que je <strong>sois</strong></td><td>que nous <strong>soyons</strong></td></tr>
            <tr><td>avoir</td><td>que j'<strong>aie</strong></td><td>que nous <strong>ayons</strong></td></tr>
            <tr><td>faire</td><td>que je <strong>fasse</strong></td><td>que nous <strong>fassions</strong></td></tr>
            <tr><td>aller</td><td>que j'<strong>aille</strong></td><td>que nous <strong>allions</strong></td></tr>
            <tr><td>pouvoir</td><td>que je <strong>puisse</strong></td><td>que nous <strong>puissions</strong></td></tr>
            <tr><td>savoir</td><td>que je <strong>sache</strong></td><td>que nous <strong>sachions</strong></td></tr>
            <tr><td>vouloir</td><td>que je <strong>veuille</strong></td><td>que nous <strong>voulions</strong></td></tr>
            <tr><td>venir</td><td>que je <strong>vienne</strong></td><td>que nous <strong>venions</strong></td></tr>
            <tr><td>prendre</td><td>que je <strong>prenne</strong></td><td>que nous <strong>prenions</strong></td></tr>
        </tbody>
    </table>

    <h3>Quand l'utiliser ?</h3>
    
    <div class="example-box">
        <h4>1. üí™ N√©cessit√© / Obligation</h4>
        <ul>
            <li><strong>Il faut que</strong> je <strong>fasse</strong> mes devoirs.</li>
            <li><strong>Il est n√©cessaire que</strong> tu <strong>viennes</strong>.</li>
            <li><strong>Il est important que</strong> nous <strong>soyons</strong> √† l'heure.</li>
        </ul>
    </div>

    <div class="example-box">
        <h4>2. ‚ú® Souhait / Volont√©</h4>
        <ul>
            <li><strong>Je veux que</strong> tu <strong>r√©ussisses</strong>.</li>
            <li><strong>J'aimerais que</strong> vous <strong>veniez</strong>.</li>
            <li><strong>Je souhaite que</strong> tu <strong>ailles</strong> bien.</li>
        </ul>
    </div>

    <div class="example-box">
        <h4>3. üòäüò¢ √âmotion</h4>
        <ul>
            <li><strong>Je suis content que</strong> tu <strong>sois</strong> l√†.</li>
            <li><strong>J'ai peur que</strong> il <strong>pleuve</strong>.</li>
            <li><strong>Je regrette que</strong> tu ne <strong>puisses</strong> pas venir.</li>
        </ul>
    </div>

    <div class="example-box">
        <h4>4. ü§î Doute / Possibilit√©</h4>
        <ul>
            <li><strong>Je doute que</strong> il <strong>vienne</strong>.</li>
            <li><strong>Il est possible que</strong> nous <strong>partions</strong> demain.</li>
            <li><strong>Je ne pense pas que</strong> ce <strong>soit</strong> vrai.</li>
        </ul>
    </div>

    <div class="warning-box">
        <h4>‚ö†Ô∏è Expressions courantes avec subjonctif</h4>
        <ul>
            <li>Il faut que...</li>
            <li>Il est important que...</li>
            <li>Il est n√©cessaire que...</li>
            <li>Bien que... (although)</li>
            <li>Avant que... (before)</li>
            <li>Pour que... (so that)</li>
            <li>Sans que... (without)</li>
            <li>Jusqu'√† ce que... (until)</li>
        </ul>
    </div>

    <div class="indicatif-alert">
        <h4>‚ö†Ô∏è Opinion et certitude affirmatives ‚Üí INDICATIF</h4>
        <p>Quand tu exprimes une <strong>opinion affirm√©e</strong> ou une <strong>certitude</strong>, on garde l'indicatif, pas le subjonctif.</p>
        <p><strong>Opinion affirm√©e (‚Üí indicatif)</strong></p>
        <ul>
            <li>Je pense que tu <strong>viens</strong> demain.</li>
            <li>J'estime que cette solution <strong>fonctionne</strong>.</li>
            <li>Nous croyons que le train <strong>arrive</strong> √† 18 h.</li>
        </ul>
        <p><strong>Certitude (‚Üí indicatif)</strong></p>
        <ul>
            <li>Il est certain que nous <strong>sommes</strong> pr√™ts.</li>
            <li>Il est √©vident qu'ils <strong>ont</strong> raison.</li>
            <li>Il est clair que le concert <strong>commence</strong> √† 21 h.</li>
        </ul>
        <p>‚ö†Ô∏è Si l'opinion est n√©gative ou interrogative (<em>Je ne pense pas que..., Penses-tu que... ?</em>), on revient au <strong>subjonctif</strong>.</p>
    </div>

    <h3>Exercice</h3>
    <div class="exercise">
        <h4>Exercice : Compl√©tez avec le subjonctif pr√©sent</h4>
        <div class="question">
            1. Il faut que tu <input type="text" id="subj_1" class="answer"> (√™tre) √† l'heure.
        </div>
        <div class="question">
            2. Je doute qu'il <input type="text" id="subj_2" class="answer"> (venir) ce soir.
        </div>
        <div class="question">
            3. Je veux que vous <input type="text" id="subj_3" class="answer"> (finir) ce travail.
        </div>
        <div class="question">
            4. Je suis content que tu <input type="text" id="subj_4" class="answer"> (faire) tes devoirs.
        </div>
        <div class="question">
            5. Il est important que nous <input type="text" id="subj_5" class="answer"> (avoir) tous les documents.
        </div>
        <div class="question">
            6. Bien que je <input type="text" id="subj_6" class="answer"> (savoir) la r√©ponse, je ne vais pas te le dire.
        </div>
        <div class="question">
            7. Avant que tu <input type="text" id="subj_7" class="answer"> (partir), dis-moi au revoir.
        </div>
        <div class="question">
            8. Pour que nous <input type="text" id="subj_8" class="answer"> (r√©ussir), il faut travailler.
        </div>
        <div class="question">
            9. J'ai peur qu'il ne <input type="text" id="subj_9" class="answer"> (pleuvoir) demain.
        </div>
        <div class="question">
            10. Il est n√©cessaire que vous <input type="text" id="subj_10" class="answer"> (aller) chez le m√©decin.
        </div>
        <button onclick="checkSubjonctif()">V√©rifier</button>
        <button onclick="resetSubjonctif()">Recommencer</button>
        <div id="result-subj" class="result"></div>
    </div>

    <div class="exercise">
        <h4>Exercice : Subjonctif ou indicatif ?</h4>
        <p>Choisis la forme correcte du verbe entre les deux propositions.</p>
        <div class="question">
            1. Je pense que tu
            <select id="mode_1" class="answer">
                <option value="">-- Choisir --</option>
                <option value="viens">viens</option>
                <option value="viennes">viennes</option>
            </select>
            demain.
            <div id="mode_1-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            2. Il est certain que nous
            <select id="mode_2" class="answer">
                <option value="">-- Choisir --</option>
                <option value="sommes">sommes</option>
                <option value="soyons">soyons</option>
            </select>
            pr√™ts.
            <div id="mode_2-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            3. Je doute que vous
            <select id="mode_3" class="answer">
                <option value="">-- Choisir --</option>
                <option value="finissiez">finissiez</option>
                <option value="finissez">finissez</option>
            </select>
            avant minuit.
            <div id="mode_3-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            4. Il est possible que Pierre
            <select id="mode_4" class="answer">
                <option value="">-- Choisir --</option>
                <option value="puisse">puisse</option>
                <option value="peut">peut</option>
            </select>
            venir.
            <div id="mode_4-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            5. J'estime que ce projet
            <select id="mode_5" class="answer">
                <option value="">-- Choisir --</option>
                <option value="reussira">r√©ussira</option>
                <option value="reussisse">r√©ussisse</option>
            </select>
            rapidement.
            <div id="mode_5-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            6. Il n'est pas s√ªr qu'ils
            <select id="mode_6" class="answer">
                <option value="">-- Choisir --</option>
                <option value="soient">soient</option>
                <option value="sont">sont</option>
            </select>
            pr√™ts √† partir.
            <div id="mode_6-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            7. Il est √©vident que tu
            <select id="mode_7" class="answer">
                <option value="">-- Choisir --</option>
                <option value="as">as</option>
                <option value="aies">aies</option>
            </select>
            compris la le√ßon.
            <div id="mode_7-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            8. Je ne pense pas que Marie
            <select id="mode_8" class="answer">
                <option value="">-- Choisir --</option>
                <option value="vienne">vienne</option>
                <option value="vient">vient</option>
            </select>
            √† la f√™te.
            <div id="mode_8-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            9. Penses-tu qu'ils
            <select id="mode_9" class="answer">
                <option value="">-- Choisir --</option>
                <option value="puissent">puissent</option>
                <option value="peuvent">peuvent</option>
            </select>
            rester ?
            <div id="mode_9-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            10. Il est clair que nous
            <select id="mode_10" class="answer">
                <option value="">-- Choisir --</option>
                <option value="faisons">faisons</option>
                <option value="fassions">fassions</option>
            </select>
            de notre mieux.
            <div id="mode_10-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            11. Il vaut mieux que tu
            <select id="mode_11" class="answer">
                <option value="">-- Choisir --</option>
                <option value="viennes">viennes</option>
                <option value="viens">viens</option>
            </select>
            t√¥t.
            <div id="mode_11-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            12. Il n'est pas certain qu'il
            <select id="mode_12" class="answer">
                <option value="">-- Choisir --</option>
                <option value="ait">ait</option>
                <option value="a">a</option>
            </select>
            le temps.
            <div id="mode_12-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            13. Je suis persuad√© qu'elle
            <select id="mode_13" class="answer">
                <option value="">-- Choisir --</option>
                <option value="reussit">r√©ussit</option>
                <option value="reussisse">r√©ussisse</option>
            </select>
            son examen.
            <div id="mode_13-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            14. Il se peut que nous
            <select id="mode_14" class="answer">
                <option value="">-- Choisir --</option>
                <option value="soyons">soyons</option>
                <option value="sommes">sommes</option>
            </select>
            en retard.
            <div id="mode_14-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            15. Je crois que vous
            <select id="mode_15" class="answer">
                <option value="">-- Choisir --</option>
                <option value="etes">√™tes</option>
                <option value="soyez">soyez</option>
            </select>
            pr√™ts.
            <div id="mode_15-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            16. Il est √©vident qu'ils
            <select id="mode_16" class="answer">
                <option value="">-- Choisir --</option>
                <option value="finiront">finiront</option>
                <option value="finissent">finissent</option>
            </select>
            le projet.
            <div id="mode_16-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            17. Je doute qu'on
            <select id="mode_17" class="answer">
                <option value="">-- Choisir --</option>
                <option value="puisse">puisse</option>
                <option value="peut">peut</option>
            </select>
            partir √† l'heure.
            <div id="mode_17-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            18. Je suis certain que tu
            <select id="mode_18" class="answer">
                <option value="">-- Choisir --</option>
                <option value="feras">feras</option>
                <option value="fasses">fasses</option>
            </select>
            un excellent travail.
            <div id="mode_18-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            19. Il est vrai que nous
            <select id="mode_19" class="answer">
                <option value="">-- Choisir --</option>
                <option value="avons">avons</option>
                <option value="ayons">ayons</option>
            </select>
            besoin d'aide.
            <div id="mode_19-feedback" class="inline-feedback"></div>
        </div>
        <div class="question">
            20. Je ne suis pas s√ªr qu'elle
            <select id="mode_20" class="answer">
                <option value="">-- Choisir --</option>
                <option value="soit">soit</option>
                <option value="est">est</option>
            </select>
            disponible.
            <div id="mode_20-feedback" class="inline-feedback"></div>
        </div>
        <button onclick="checkSubjonctifMode()">V√©rifier</button>
        <button onclick="resetSubjonctifMode()">Recommencer</button>
        <div id="result-subj-mode" class="result"></div>
    </div>

    <div class="exercise">
        <h4>üéß R√©vision : Avoir vs Aller au subjonctif pr√©sent</h4>
        <p>√âcoute chaque forme pour m√©moriser la prononciation.</p>
        <div class="verb-grid">
            <div class="verb-card">
                <h5>AVOIR</h5>
                <ul>
                    <li><span>que j'<strong>aie</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('que j\'aie')">üîä</button></li>
                    <li><span>que tu <strong>aies</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('que tu aies')">üîä</button></li>
                    <li><span>qu'il/elle <strong>ait</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('quil ait')">üîä</button></li>
                    <li><span>que nous <strong>ayons</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('que nous ayons')">üîä</button></li>
                    <li><span>que vous <strong>ayez</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('que vous ayez')">üîä</button></li>
                    <li><span>qu'ils/elles <strong>aient</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('quilz aient')">üîä</button></li>
                </ul>
            </div>
            <div class="verb-card">
                <h5>ALLER</h5>
                <ul>
                    <li><span>que j'<strong>aille</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('que j\'aille')">üîä</button></li>
                    <li><span>que tu <strong>ailles</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('que tu ailles')">üîä</button></li>
                    <li><span>qu'il/elle <strong>aille</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('quil aille')">üîä</button></li>
                    <li><span>que nous <strong>allions</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('que nous allions')">üîä</button></li>
                    <li><span>que vous <strong>alliez</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('que vous alliez')">üîä</button></li>
                    <li><span>qu'ils/elles <strong>aillent</strong></span><button type="button" class="audio-chip" onclick="speakConjugaison('quilz aillent')">üîä</button></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="exercise">
        <h4>Exercice : Avoir ou Aller ?</h4>
        <p>S√©lectionne la bonne forme au subjonctif pr√©sent pour chaque phrase.</p>
        <div id="avoir-aller-questions"></div>
        <button onclick="checkAvoirAller()">V√©rifier</button>
        <button onclick="resetAvoirAller()">Recommencer</button>
        <div id="result-avoir-aller" class="result"></div>
    </div>
 
    <script>
        (function() {
            const questions = [
                { id: 'mode_1', answer: 'viens', explanation: "Opinion affirm√©e ‚Üí indicatif" },
                { id: 'mode_2', answer: 'sommes', explanation: "Certitude ‚Üí indicatif" },
                { id: 'mode_3', answer: 'finissiez', explanation: "Doute ‚Üí subjonctif" },
                { id: 'mode_4', answer: 'puisse', explanation: "Possibilit√© ‚Üí subjonctif" },
                { id: 'mode_5', answer: 'reussira', explanation: "Opinion positive affirm√©e ‚Üí indicatif" },
                { id: 'mode_6', answer: 'soient', explanation: "Incertitude ‚Üí subjonctif" },
                { id: 'mode_7', answer: 'as', explanation: "Certitude ‚Üí indicatif" },
                { id: 'mode_8', answer: 'vienne', explanation: "Opinion n√©gative ‚Üí subjonctif" },
                { id: 'mode_9', answer: 'puissent', explanation: "Question sur l'opinion ‚Üí subjonctif" },
                { id: 'mode_10', answer: 'faisons', explanation: "Certitude ‚Üí indicatif" },
                { id: 'mode_11', answer: 'viennes', explanation: "Conseil / n√©cessit√© ‚Üí subjonctif" },
                { id: 'mode_12', answer: 'ait', explanation: "Incertitude ‚Üí subjonctif" },
                { id: 'mode_13', answer: 'reussit', explanation: "Certitude ‚Üí indicatif" },
                { id: 'mode_14', answer: 'soyons', explanation: "Possibilit√© ‚Üí subjonctif" },
                { id: 'mode_15', answer: 'etes', explanation: "Opinion affirm√©e ‚Üí indicatif" },
                { id: 'mode_16', answer: 'finiront', explanation: "Certitude ‚Üí indicatif" },
                { id: 'mode_17', answer: 'puisse', explanation: "Doute ‚Üí subjonctif" },
                { id: 'mode_18', answer: 'feras', explanation: "Certitude ‚Üí indicatif" },
                { id: 'mode_19', answer: 'avons', explanation: "Certitude ‚Üí indicatif" },
                { id: 'mode_20', answer: 'soit', explanation: "Incertitude ‚Üí subjonctif" }
            ];

            function normalize(value) {
                return (value || '')
                    .toString()
                    .trim()
                    .toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '');
            }

            function getLabel(selectEl, expected) {
                const normalizedExpected = normalize(expected);
                const option = Array.from(selectEl.options).find(opt => normalize(opt.value) === normalizedExpected);
                return option ? option.textContent.trim() : expected;
            }

            function toggleFeedback(feedback, message, status) {
                if (!feedback) return;
                feedback.innerHTML = message;
                feedback.className = `inline-feedback ${status}`;
                feedback.style.visibility = 'visible';
            }

            window.checkSubjonctifMode = function() {
                const result = document.getElementById('result-subj-mode');
                if (!result) return;

                let correct = 0;
                questions.forEach(q => {
                    const select = document.getElementById(q.id);
                    const feedback = document.getElementById(`${q.id}-feedback`);
                    if (!select) return;

                    const value = normalize(select.value);
                    const expected = normalize(q.answer);
                    const label = getLabel(select, q.answer);

                    select.classList.remove('correct', 'incorrect');

                    if (!select.value) {
                        toggleFeedback(feedback, `‚ùå ${q.explanation} ‚Üí tu dois choisir une forme.`, 'bad');
                        select.classList.add('incorrect');
                        return;
                    }

                    if (value === expected) {
                        toggleFeedback(feedback, `‚úÖ ${q.explanation}`, 'good');
                        select.classList.add('correct');
                        correct++;
                    } else {
                        toggleFeedback(feedback, `‚ùå ${q.explanation} ‚Üí forme attendue : <strong>${label}</strong>`, 'bad');
                        select.classList.add('incorrect');
                    }
                });

                const total = questions.length;
                const percentage = (correct / total) * 100;

                if (percentage === 100) {
                    result.className = 'result show success';
                    result.textContent = `üéØ Parfait ! ${correct}/${total} r√©ponses justes.`;
                } else if (percentage >= 70) {
                    result.className = 'result show partial';
                    result.textContent = `üëç ${correct}/${total} ‚Äî tr√®s bien ! Continue !`;
                } else {
                    result.className = 'result show partial';
                    result.textContent = `üí° ${correct}/${total} ‚Äî relis la r√®gle opinion/certitude vs subjonctif.`;
                }
            };

            window.resetSubjonctifMode = function() {
                questions.forEach(q => {
                    const select = document.getElementById(q.id);
                    const feedback = document.getElementById(`${q.id}-feedback`);
                    if (!select) return;
                    select.value = '';
                    select.className = 'answer';
                    if (feedback) {
                        feedback.innerHTML = '';
                        feedback.className = 'inline-feedback';
                        feedback.style.visibility = 'hidden';
                    }
                });

                const result = document.getElementById('result-subj-mode');
                if (result) {
                    result.className = 'result';
                    result.innerHTML = '';
                }
            };

            const avoirAllerQuestions = [
                {
                    id: 'aa1',
                    text: "Il faut que tu ___ plus de patience.",
                    options: [
                        { value: 'aies', label: 'aies (avoir)' },
                        { value: 'ailles', label: 'ailles (aller)' }
                    ],
                    answer: 'aies',
                    explanation: "On exprime une possession ‚Üí verbe \"avoir\"."
                },
                {
                    id: 'aa2',
                    text: "Il est n√©cessaire que nous ___ √† Paris demain matin.",
                    options: [
                        { value: 'allions', label: 'allions (aller)' },
                        { value: 'ayons', label: 'ayons (avoir)' }
                    ],
                    answer: 'allions',
                    explanation: "D√©placement ‚Üí verbe \"aller\"."
                },
                {
                    id: 'aa3',
                    text: "Je doute qu'ils ___ assez d'exp√©rience.",
                    options: [
                        { value: 'aient', label: 'aient (avoir)' },
                        { value: 'aillent', label: 'aillent (aller)' }
                    ],
                    answer: 'aient',
                    explanation: "On parle de poss√©der de l'exp√©rience ‚Üí \"avoir\"."
                },
                {
                    id: 'aa4',
                    text: "Il est important que vous ___ chez le m√©decin.",
                    options: [
                        { value: 'alliez', label: 'alliez (aller)' },
                        { value: 'ayez', label: 'ayez (avoir)' }
                    ],
                    answer: 'alliez',
                    explanation: "Aller quelque part ‚Üí verbe \"aller\"."
                },
                {
                    id: 'aa5',
                    text: "Je pr√©f√®re que j' ___ chez toi ce soir.",
                    options: [
                        { value: 'aille', label: "aille (aller)" },
                        { value: 'aie', label: "aie (avoir)" }
                    ],
                    answer: 'aille',
                    explanation: "Se d√©placer chez quelqu'un ‚Üí \"aller\"."
                },
                {
                    id: 'aa6',
                    text: "Le professeur veut que nous ___ nos cahiers avec nous.",
                    options: [
                        { value: 'ayons', label: 'ayons (avoir)' },
                        { value: 'allions', label: 'allions (aller)' }
                    ],
                    answer: 'ayons',
                    explanation: "Possession d'objets ‚Üí \"avoir\"."
                },
                {
                    id: 'aa7',
                    text: "Elle souhaite que tu ___ au bureau d√®s 9 h.",
                    options: [
                        { value: 'ailles', label: 'ailles (aller)' },
                        { value: 'aies', label: 'aies (avoir)' }
                    ],
                    answer: 'ailles',
                    explanation: "D√©placement vers un lieu ‚Üí \"aller\"."
                },
                {
                    id: 'aa8',
                    text: "Je suis content que vous ___ du temps pour nous.",
                    options: [
                        { value: 'ayez', label: 'ayez (avoir)' },
                        { value: 'alliez', label: 'alliez (aller)' }
                    ],
                    answer: 'ayez',
                    explanation: "Avoir du temps = poss√©der ‚Üí \"avoir\"."
                },
                {
                    id: 'aa9',
                    text: "Il faut que j' ___ assez d'argent pour payer.",
                    options: [
                        { value: 'aie', label: "aie (avoir)" },
                        { value: 'aille', label: "aille (aller)" }
                    ],
                    answer: 'aie',
                    explanation: "On poss√®de de l'argent ‚Üí \"avoir\"."
                },
                {
                    id: 'aa10',
                    text: "Ils pr√©f√®rent que nous ___ chez eux ce soir.",
                    options: [
                        { value: 'allions', label: 'allions (aller)' },
                        { value: 'ayons', label: 'ayons (avoir)' }
                    ],
                    answer: 'allions',
                    explanation: "Se rendre chez quelqu'un ‚Üí \"aller\"."
                }
            ];

            function renderAvoirAllerQuestions() {
                const container = document.getElementById('avoir-aller-questions');
                if (!container) return;

                container.innerHTML = avoirAllerQuestions.map((q, index) => {
                    const selectOptions = ['<option value="">-- Choisir --</option>']
                        .concat(q.options.map(opt => `<option value="${opt.value}">${opt.label}</option>`))
                        .join('');
                    const selectHtml = `<select id="${q.id}" class="answer">${selectOptions}</select>`;
                    const questionText = q.text.replace('___', selectHtml);
                    return `
                        <div class="question aa-question">
                            ${index + 1}. ${questionText}
                            <div id="${q.id}-feedback" class="inline-feedback"></div>
                        </div>
                    `;
                }).join('');

                avoirAllerQuestions.forEach(q => {
                    const feedback = document.getElementById(`${q.id}-feedback`);
                    if (feedback) {
                        feedback.style.visibility = 'hidden';
                    }
                });
            }

            window.checkAvoirAller = function() {
                const result = document.getElementById('result-avoir-aller');
                if (!result) return;

                let correct = 0;

                avoirAllerQuestions.forEach(q => {
                    const select = document.getElementById(q.id);
                    const feedback = document.getElementById(`${q.id}-feedback`);
                    if (!select) return;

                    const value = normalize(select.value);
                    const expected = normalize(q.answer);
                    const label = getLabel(select, q.answer);

                    select.classList.remove('correct', 'incorrect');

                    if (!select.value) {
                        toggleFeedback(feedback, `‚ùå ${q.explanation} ‚Üí choisis une forme.`, 'bad');
                        select.classList.add('incorrect');
                        return;
                    }

                    if (value === expected) {
                        toggleFeedback(feedback, `‚úÖ ${q.explanation}`, 'good');
                        select.classList.add('correct');
                        correct++;
                    } else {
                        toggleFeedback(feedback, `‚ùå ${q.explanation} ‚Üí forme attendue : <strong>${label}</strong>`, 'bad');
                        select.classList.add('incorrect');
                    }
                });

                const total = avoirAllerQuestions.length;
                const percentage = (correct / total) * 100;

                if (percentage === 100) {
                    result.className = 'result show success';
                    result.textContent = `üéâ Bravo ! ${correct}/${total} ‚Äî tu distingues parfaitement \"avoir\" et \"aller\".`;
                } else if (percentage >= 70) {
                    result.className = 'result show partial';
                    result.textContent = `üëç ${correct}/${total} ‚Äî encore quelques d√©tails et ce sera parfait !`;
                } else {
                    result.className = 'result show partial';
                    result.textContent = `üí° ${correct}/${total} ‚Äî relis les conjugaisons ci-dessus et r√©essaie.`;
                }
            };

            window.resetAvoirAller = function() {
                avoirAllerQuestions.forEach(q => {
                    const select = document.getElementById(q.id);
                    const feedback = document.getElementById(`${q.id}-feedback`);
                    if (!select) return;
                    select.value = '';
                    select.className = 'answer';
                    if (feedback) {
                        feedback.innerHTML = '';
                        feedback.className = 'inline-feedback';
                        feedback.style.visibility = 'hidden';
                    }
                });

                const result = document.getElementById('result-avoir-aller');
                if (result) {
                    result.className = 'result';
                    result.textContent = '';
                }
            };

            window.speakConjugaison = function(rawText) {
                if (!('speechSynthesis' in window)) {
                    alert('La synth√®se vocale n\'est pas disponible sur ce navigateur.');
                    return;
                }

                const formatted = rawText
                    .replace(/quilz/g, "qu'ils")
                    .replace(/quil/g, "qu'il")
                    .replace(/\s+/g, ' ')
                    .replace(/‚Äô/g, "'");

                const synth = window.speechSynthesis;

                const speak = () => {
                    synth.cancel();
                    synth.resume();

                    const utterance = new SpeechSynthesisUtterance(formatted);
                    utterance.lang = 'fr-FR';
                    utterance.rate = 1;
                    utterance.pitch = 1;

                    const voices = synth.getVoices().filter(v => v.lang && v.lang.toLowerCase().startsWith('fr'));
                    if (voices.length) {
                        utterance.voice = voices[0];
                    }

                    synth.speak(utterance);
                };

                if (!synth.getVoices().length) {
                    const once = () => {
                        synth.removeEventListener('voiceschanged', once);
                        speak();
                    };
                    synth.addEventListener('voiceschanged', once);
                    synth.getVoices();
                    setTimeout(() => {
                        if (synth.getVoices().length) speak();
                    }, 400);
                } else {
                    speak();
                }
            };

            renderAvoirAllerQuestions();
        })();
    </script>

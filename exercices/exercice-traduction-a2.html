    <button class="back-btn" onclick="backToSection('exercices')">‚Üê Retour</button>
    
    <h2>üåç Exercice de Traduction - Niveau A2</h2>

    <div class="exercise translation-exercise">
        <div class="game-card translation-card">
            <div class="game-card-header">
                <h2>üåç Traduction Anglais ‚Üí Fran√ßais</h2>
            </div>
            <div class="game-card-body">
                <div class="translation-question">
                    <p id="translation-question"></p>
                </div>
                <div class="translation-input">
                    <input type="text" id="translation-answer" placeholder="√âcrivez votre traduction ici..." />
                    <button id="translation-validate" onclick="validateTranslation()">Valider</button>
                </div>
                <div id="translation-result" class="translation-result" style="display: none;">
                    <p id="translation-result-explanation"></p>
                    <button id="translation-next" onclick="nextTranslation()">Suivant</button>
                </div>
                <div class="translation-progress">
                    <p id="translation-progress-text"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Liste des phrases √† traduire (en enlevant les phrases indiqu√©es)
        const translationPhrases = [
            { en: "I drink water every day.", fr: "Je bois de l'eau tous les jours.", synonyms: [] },
            { en: "She cooked dinner last night.", fr: "Elle a pr√©par√© le d√Æner hier soir.", synonyms: ["Elle a cuisin√© le d√Æner hier soir"] },
            { en: "We play tennis on Saturdays.", fr: "Nous jouons au tennis le samedi.", synonyms: ["Nous jouons au tennis les samedis", "On joue au tennis le samedi", "On joue au tennis les samedis"] },
            { en: "He took the metro this morning.", fr: "Il a pris le m√©tro ce matin.", synonyms: [] },
            { en: "They speak three languages.", fr: "Ils parlent trois langues.", synonyms: [] },
            { en: "You forgot your umbrella.", fr: "Tu as oubli√© ton parapluie.", synonyms: ["Vous avez oubli√© votre parapluie"] },
            { en: "I sleep eight hours per night.", fr: "Je dors huit heures par nuit.", synonyms: ["Je dors huit heures chaque nuit"] },
            { en: "We watched the news yesterday.", fr: "Nous avons regard√© les informations hier.", synonyms: ["Nous avons regard√© les actualit√©s hier", "Nous avons regard√© les infos hier"] },
            { en: "They sold their house.", fr: "Ils ont vendu leur maison.", synonyms: [] },
            { en: "My father reads the newspaper.", fr: "Mon p√®re lit le journal.", synonyms: ["Mon p√®re lit le quotidien"] },
            { en: "I received a letter from my friend.", fr: "J'ai re√ßu une lettre de mon ami.", synonyms: ["J'ai re√ßu une lettre de mon amie"] },
            { en: "We listen to the radio in the car.", fr: "Nous √©coutons la radio dans la voiture.", synonyms: ["Nous √©coutons la radio en voiture"] },
            { en: "He finished his project.", fr: "Il a termin√© son projet.", synonyms: ["Il a fini son projet"] },
            { en: "You drink too much coffee.", fr: "Tu bois trop de caf√©.", synonyms: ["Vous buvez trop de caf√©"] },
            { en: "She met her teacher at the market.", fr: "Elle a rencontr√© son professeur au march√©.", synonyms: ["Elle a rencontr√© son enseignant au march√©"] },
            { en: "I work from Monday to Friday.", fr: "Je travaille du lundi au vendredi.", synonyms: ["Je travaille de lundi √† vendredi"] },
            { en: "They traveled to Spain last month.", fr: "Ils ont voyag√© en Espagne le mois dernier.", synonyms: ["Ils ont fait un voyage en Espagne le mois dernier"] },
            { en: "We eat vegetables every day.", fr: "Nous mangeons des l√©gumes tous les jours.", synonyms: [] },
            { en: "I fell in the street.", fr: "Je suis tomb√© dans la rue.", synonyms: ["Je suis tomb√©e dans la rue"] },
            { en: "I wake up at six o'clock every morning.", fr: "Je me r√©veille √† six heures tous les matins.", synonyms: ["Je me r√©veille √† six heures chaque matin"] },
            { en: "They bought bread at the bakery.", fr: "Ils ont achet√© du pain √† la boulangerie.", synonyms: [] },
            { en: "She drinks tea with her friends.", fr: "Elle boit du th√© avec ses amis.", synonyms: ["Elle boit du th√© avec ses amies"] },
            { en: "We arrived on time yesterday.", fr: "Nous sommes arriv√©s √† l'heure hier.", synonyms: ["Nous sommes arriv√©es √† l'heure hier"] },
            { en: "He writes emails all day.", fr: "Il √©crit des emails toute la journ√©e.", synonyms: ["Il √©crit des courriels toute la journ√©e"] },
            { en: "You answered all the questions.", fr: "Tu as r√©pondu √† toutes les questions.", synonyms: ["Vous avez r√©pondu √† toutes les questions"] },
            { en: "I love French music.", fr: "J'aime la musique fran√ßaise.", synonyms: [] },
            { en: "We go to the park on Sundays.", fr: "Nous allons au parc le dimanche.", synonyms: ["Nous allons au parc les dimanches"] },
            { en: "They learned a new song.", fr: "Ils ont appris une nouvelle chanson.", synonyms: [] },
            { en: "My mother cooks very well.", fr: "Ma m√®re cuisine tr√®s bien.", synonyms: [] },
            { en: "I broke my phone.", fr: "J'ai cass√© mon t√©l√©phone.", synonyms: ["J'ai cass√© mon portable"] },
            { en: "You understand everything.", fr: "Tu comprends tout.", synonyms: ["Vous comprenez tout"] },
            { en: "He returned home late.", fr: "Il est rentr√© tard √† la maison.", synonyms: ["Il est retourn√© chez lui tard"] },
            { en: "We need more time.", fr: "Nous avons besoin de plus de temps.", synonyms: [] },
            { en: "She lost the match.", fr: "Elle a perdu le match.", synonyms: [] },
            { en: "I run every morning.", fr: "Je cours tous les matins.", synonyms: ["Je cours chaque matin"] },
            { en: "They closed the door.", fr: "Ils ont ferm√© la porte.", synonyms: [] },
            { en: "You have a beautiful garden.", fr: "Tu as un beau jardin.", synonyms: ["Vous avez un beau jardin"] },
            { en: "We spent three days in Lyon.", fr: "Nous avons pass√© trois jours √† Lyon.", synonyms: [] },
            { en: "I swim in the pool every week.", fr: "Je nage dans la piscine chaque semaine.", synonyms: ["Je nage dans la piscine toutes les semaines"] },
            { en: "We sing in the shower.", fr: "Nous chantons sous la douche.", synonyms: ["Nous chantons dans la douche"] },
            { en: "He missed the train this morning.", fr: "Il a rat√© le train ce matin.", synonyms: ["Il a manqu√© le train ce matin"] },
            { en: "They know the answer.", fr: "Ils connaissent la r√©ponse.", synonyms: ["Ils savent la r√©ponse"] },
            { en: "You helped your sister yesterday.", fr: "Tu as aid√© ta s≈ìur hier.", synonyms: ["Vous avez aid√© votre s≈ìur hier", "Tu as aid√© ta soeur hier", "Vous avez aid√© votre soeur hier"] },
            { en: "I wear glasses.", fr: "Je porte des lunettes.", synonyms: [] },
            { en: "We celebrated his birthday.", fr: "Nous avons f√™t√© son anniversaire.", synonyms: ["Nous avons c√©l√©br√© son anniversaire"] },
            { en: "She drives a blue car.", fr: "Elle conduit une voiture bleue.", synonyms: [] },
            { en: "You live near the station.", fr: "Tu habites pr√®s de la gare.", synonyms: ["Vous habitez pr√®s de la gare"] },
            { en: "They won the game.", fr: "Ils ont gagn√© le jeu.", synonyms: ["Ils ont gagn√© la partie"] },
            { en: "He feels tired today.", fr: "Il se sent fatigu√© aujourd'hui.", synonyms: [] },
            { en: "We heard a strange noise.", fr: "Nous avons entendu un bruit √©trange.", synonyms: ["Nous avons entendu un bruit bizarre"] },
            { en: "I start work at nine o'clock.", fr: "Je commence le travail √† neuf heures.", synonyms: ["Je commence √† travailler √† neuf heures"] },
            { en: "She became a doctor.", fr: "Elle est devenue m√©decin.", synonyms: [] },
            { en: "We think about our vacation.", fr: "Nous pensons √† nos vacances.", synonyms: [] },
            { en: "You ran in the park.", fr: "Tu as couru dans le parc.", synonyms: ["Vous avez couru dans le parc"] },
            { en: "I send messages to my friends.", fr: "J'envoie des messages √† mes amis.", synonyms: ["J'envoie des messages √† mes amies"] }
        ];

        let currentTranslationIndex = -1;
        let translationScore = 0;
        let totalAnswered = 0;
        let usedPhrases = [];

        function initTranslationGame() {
            currentTranslationIndex = -1;
            translationScore = 0;
            totalAnswered = 0;
            usedPhrases = [];
            nextTranslation();
        }

        function nextTranslation() {
            // R√©initialiser l'√©tat
            const resultDiv = document.getElementById('translation-result');
            const questionDiv = document.getElementById('translation-question');
            const answerInput = document.getElementById('translation-answer');
            const validateBtn = document.getElementById('translation-validate');
            const progressText = document.getElementById('translation-progress-text');
            
            if (resultDiv) resultDiv.style.display = 'none';
            if (answerInput) {
                answerInput.value = '';
                answerInput.disabled = false;
                answerInput.focus();
            }
            if (validateBtn) validateBtn.disabled = false;
            
            // S√©lectionner une phrase al√©atoire non encore utilis√©e
            let availablePhrases = translationPhrases.filter((_, index) => !usedPhrases.includes(index));
            
            if (availablePhrases.length === 0) {
                // Toutes les phrases ont √©t√© utilis√©es, r√©initialiser
                usedPhrases = [];
                availablePhrases = translationPhrases;
            }
            
            const randomIndex = Math.floor(Math.random() * availablePhrases.length);
            const selectedPhrase = availablePhrases[randomIndex];
            currentTranslationIndex = translationPhrases.indexOf(selectedPhrase);
            usedPhrases.push(currentTranslationIndex);
            
            // Afficher la question
            if (questionDiv) {
                questionDiv.textContent = selectedPhrase.en;
            }
            
            // Mettre √† jour le progr√®s
            if (progressText) {
                const remaining = translationPhrases.length - usedPhrases.length;
                progressText.textContent = `${usedPhrases.length} / ${translationPhrases.length} phrases traduites`;
            }
        }

        function normalizeText(text) {
            // Normaliser: minuscules, enlever accents, ligatures, espaces multiples, ponctuation
            return text
                .toLowerCase()
                .replace(/≈ì/g, 'oe') // Convertir ligature ≈ì vers oe
                .replace(/≈í/g, 'OE') // Convertir ligature ≈í vers OE (majuscule)
                .replace(/√¶/g, 'ae') // Convertir ligature √¶ vers ae
                .replace(/√Ü/g, 'AE') // Convertir ligature √Ü vers AE (majuscule)
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '') // Enlever accents
                .replace(/[.,!?;:]/g, '') // Enlever ponctuation
                .replace(/\s+/g, ' ') // Espaces multiples -> un seul
                .trim();
        }

        // Fonction pour jouer un son de succ√®s
        function playSuccessSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const now = audioContext.currentTime;
                
                // Cr√©er deux oscillateurs pour un accord
                const osc1 = audioContext.createOscillator();
                const osc2 = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                osc1.connect(gainNode);
                osc2.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Accord majeur (Do-Mi-Sol) mais plus simple avec juste Do-Mi
                osc1.frequency.value = 523.25; // Do (C5)
                osc2.frequency.value = 659.25; // Mi (E5)
                
                osc1.type = 'sine';
                osc2.type = 'sine';
                
                // Enveloppe douce et courte
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.2, now + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.25);
                
                osc1.start(now);
                osc2.start(now);
                osc1.stop(now + 0.25);
                osc2.stop(now + 0.25);
            } catch (error) {
                // Si l'API Web Audio n'est pas disponible, on ignore silencieusement
                // (certains navigateurs n√©cessitent une interaction utilisateur avant)
            }
        }

        // Fonction pour g√©n√©rer des variantes "nous" <-> "on"
        function generateNousOnVariants(text) {
            const variants = [text];
            let variantOn = text;
            
            // Mappage complet des conjugaisons nous -> on
            const conjugaisons = [
                // Auxiliaires
                { nous: /\bnous avons\b/gi, on: 'on a' },
                { nous: /\bnous sommes\b/gi, on: 'on est' },
                { nous: /\bnous allons\b/gi, on: 'on va' },
                // Verbes r√©guliers en -er
                { nous: /\bnous jouons\b/gi, on: 'on joue' },
                { nous: /\bnous regardons\b/gi, on: 'on regarde' },
                { nous: /\bnous √©coutons\b/gi, on: 'on √©coute' },
                { nous: /\bnous parlons\b/gi, on: 'on parle' },
                { nous: /\bnous pensons\b/gi, on: 'on pense' },
                { nous: /\bnous achetons\b/gi, on: 'on ach√®te' },
                { nous: /\bnous f√™tons\b/gi, on: 'on f√™te' },
                { nous: /\bnous chantons\b/gi, on: 'on chante' },
                { nous: /\bnous voyageons\b/gi, on: 'on voyage' },
                { nous: /\bnous aimons\b/gi, on: 'on aime' },
                // Verbes irr√©guliers
                { nous: /\bnous faisons\b/gi, on: 'on fait' },
                { nous: /\bnous disons\b/gi, on: 'on dit' },
                { nous: /\bnous voyons\b/gi, on: 'on voit' },
                { nous: /\bnous savons\b/gi, on: 'on sait' },
                { nous: /\bnous voulons\b/gi, on: 'on veut' },
                { nous: /\bnous pouvons\b/gi, on: 'on peut' },
                { nous: /\bnous devons\b/gi, on: 'on doit' },
                { nous: /\bnous venons\b/gi, on: 'on vient' },
                { nous: /\bnous mangeons\b/gi, on: 'on mange' },
                { nous: /\bnous buvons\b/gi, on: 'on boit' },
                { nous: /\bnous apprenons\b/gi, on: 'on apprend' },
                { nous: /\bnous connaissons\b/gi, on: 'on conna√Æt' }
            ];
            
            // Appliquer tous les remplacements
            conjugaisons.forEach(({ nous, on }) => {
                variantOn = variantOn.replace(nous, (match) => {
                    // Conserver la casse
                    if (match[0] === match[0].toUpperCase()) {
                        return on.charAt(0).toUpperCase() + on.slice(1);
                    }
                    return on;
                });
            });
            
            // Pour les verbes g√©n√©riques qui finissent par -ons, essayer de les convertir
            variantOn = variantOn.replace(/\bnous (\w+)ons\b/gi, (match, verbe) => {
                // Ignorer si d√©j√† remplac√©
                if (!match.toLowerCase().includes('nous')) {
                    return match;
                }
                
                const baseVerbe = verbe.toLowerCase();
                // Pour les verbes en -er, enlever -ons et ajouter -e
                let formeOn = baseVerbe.replace(/ons$/, 'e');
                
                // Cas sp√©ciaux d√©j√† trait√©s ci-dessus, on les ignore
                const dejaTraite = ['jouons', 'regardons', '√©coutons', 'parlons', 'pensons', 
                                   'achetons', 'f√™tons', 'chantons', 'voyageons', 'aimons',
                                   'faisons', 'disons', 'voyons', 'savons', 'voulons', 'pouvons',
                                   'devons', 'venons', 'mangeons', 'buvons', 'apprenons', 'connaissons'];
                
                if (dejaTraite.includes(baseVerbe)) {
                    return match; // Laisser le remplacement pr√©c√©dent
                }
                
                return match.toLowerCase().startsWith('n') ? `on ${formeOn}` : `On ${formeOn}`;
            });
            
            if (variantOn !== text && !variants.includes(variantOn)) {
                variants.push(variantOn);
            }
            
            return variants;
        }

        function validateTranslation() {
            const answerInput = document.getElementById('translation-answer');
            const resultDiv = document.getElementById('translation-result');
            const resultExplanation = document.getElementById('translation-result-explanation');
            const validateBtn = document.getElementById('translation-validate');
            
            if (!answerInput || !resultDiv || !resultExplanation || currentTranslationIndex === -1) return;
            
            const userAnswer = answerInput.value.trim();
            const currentPhrase = translationPhrases[currentTranslationIndex];
            const correctAnswer = currentPhrase.fr;
            
            // D√©sactiver l'input et le bouton
            answerInput.disabled = true;
            if (validateBtn) validateBtn.disabled = true;
            
            // Normaliser les r√©ponses pour comparaison
            const normalizedUserAnswer = normalizeText(userAnswer);
            const normalizedCorrectAnswer = normalizeText(correctAnswer);
            
            // G√©n√©rer les variantes "nous" <-> "on" pour la r√©ponse correcte et les synonymes
            const correctVariants = generateNousOnVariants(correctAnswer);
            
            // V√©rifier la r√©ponse exacte
            let isCorrect = normalizedUserAnswer === normalizedCorrectAnswer;
            
            // V√©rifier les variantes nous/on de la r√©ponse correcte
            if (!isCorrect) {
                for (const variant of correctVariants) {
                    if (normalizedUserAnswer === normalizeText(variant)) {
                        isCorrect = true;
                        break;
                    }
                }
            }
            
            // V√©rifier les synonymes si la r√©ponse n'est pas exacte
            if (!isCorrect && currentPhrase.synonyms && currentPhrase.synonyms.length > 0) {
                for (const synonym of currentPhrase.synonyms) {
                    if (normalizedUserAnswer === normalizeText(synonym)) {
                        isCorrect = true;
                        break;
                    }
                    // V√©rifier aussi les variantes nous/on des synonymes
                    const synonymVariants = generateNousOnVariants(synonym);
                    for (const variant of synonymVariants) {
                        if (normalizedUserAnswer === normalizeText(variant)) {
                            isCorrect = true;
                            break;
                        }
                    }
                    if (isCorrect) break;
                }
            }
            
            // V√©rifier √©galement des variations de synonymes communs (√©trange/bizarre, etc.)
            if (!isCorrect) {
                // Liste de synonymes communs √† accepter
                const commonSynonyms = [
                    ['√©trange', 'bizarre'],
                    ['voiture', 'auto'],
                    ['t√©l√©phone', 'portable'],
                    ['courriels', 'emails', 'e-mails'],
                    ['informations', 'infos', 'actualit√©s', 'nouvelles'],
                    ['jou√©', 'jou√© au'],
                    ['manger', 'mangeons'],
                    ['tu', 'vous'],
                    ['il', 'elle'],
                    ['mes', 'mon'],
                    ['ses', 'son'],
                    ['tous les jours', 'chaque jour'],
                    ['tous les matins', 'chaque matin'],
                    ['toutes les semaines', 'chaque semaine'],
                    ['le samedi', 'les samedis'],
                    ['le dimanche', 'les dimanches']
                ];
                
                // V√©rifier si la r√©ponse contient des synonymes acceptables
                let modifiedCorrect = normalizedCorrectAnswer;
                for (const synonymGroup of commonSynonyms) {
                    for (const synonym of synonymGroup) {
                        if (normalizedCorrectAnswer.includes(synonym)) {
                            for (const altSynonym of synonymGroup) {
                                if (normalizedUserAnswer.includes(altSynonym)) {
                                    // Remplacer temporairement pour comparaison
                                    modifiedCorrect = normalizedCorrectAnswer.replace(synonym, altSynonym);
                                    if (normalizedUserAnswer === normalizeText(modifiedCorrect)) {
                                        isCorrect = true;
                                        break;
                                    }
                                }
                            }
                        }
                        if (isCorrect) break;
                    }
                    if (isCorrect) break;
                }
            }
            
            totalAnswered++;
            if (isCorrect) {
                translationScore++;
                // Jouer le son de succ√®s
                playSuccessSound();
            }
            
            // Afficher le r√©sultat
            if (isCorrect) {
                resultDiv.className = 'translation-result correct';
            } else {
                resultDiv.className = 'translation-result incorrect';
            }
            
            resultExplanation.innerHTML = isCorrect 
                ? `<strong>‚úÖ Correct !</strong><br>${correctAnswer}`
                : `<strong>‚ùå Incorrect</strong><br>La bonne r√©ponse √©tait : <strong>${correctAnswer}</strong>`;
            
            resultDiv.style.display = 'block';
        }

        // Initialiser le jeu au chargement
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initTranslationGame);
        } else {
            // DOM d√©j√† charg√©
            setTimeout(initTranslationGame, 100);
        }

        // Permettre de valider avec Enter
        setTimeout(function() {
            const answerInput = document.getElementById('translation-answer');
            if (answerInput) {
                answerInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !answerInput.disabled) {
                        validateTranslation();
                    }
                });
            }
        }, 100);
    </script>

